---
import person from "../assets/icons/person.svg";
import MainLayout from "../layout/MainLayout.astro";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);

if (!session) {
  return Astro.redirect("/sign-in");
}
---
<MainLayout title="Open Book">
  <body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <div class="bg-gray-800 shadow-lg p-6 rounded-lg text-center mb-8">
        <h1 class="text-2xl lg:text-4xl font-bold text-blue-400">
          <span class="text-white"><strong>MI CUENTA</strong></span>
        </h1>
        <p class="text-gray-500 mt-2 font-bold">
          {session.user!.name}
          <span class="text-sm text-green-600 font-bold"> | Membresía de la cuenta Activa |</span>
        </p>
      </div>

      <!-- Contenido principal -->
      <div class="flex flex-col lg:flex-row gap-8">
        <!-- Sección de perfil -->
        <div class="lg:w-1/3 bg-white rounded-xl shadow-lg p-6">
          <div class="flex flex-col items-center">
            <!-- Foto de perfil -->
            <div class="w-32 h-32 rounded-full overflow-hidden mb-4">
              <img src={session.user!.image || person.src} alt="Profile" class="w-full h-full object-cover">
            </div>
            <h2 class="text-xl font-bold text-gray-800">{session.user!.name}</h2>
            <p class="text-gray-600">{session.user!.email}</p>
          </div>

          <!-- Botones de acción -->
          <div class="mt-6 flex flex-col gap-3">
            <a href="#" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg inline-flex items-center justify-center">
              <i class="fas fa-home mr-2"></i> Inicio
            </a>
            <button onclick="document.getElementById('modal').classList.remove('hidden')" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg">
              <i class="fas fa-lock mr-2"></i> Cambiar contraseña
            </button>
            <button class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
              <i class="fas fa-right-from-bracket mr-2"></i> Cerrar sesión
            </button>
          </div>
        </div>

        <!-- Sección de detalles de la cuenta -->
        <div class="lg:w-2/3 bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4">Detalles de la Cuenta</h2>
          <table class="w-full table-auto text-sm mb-6">
            <tbody>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Autorización de correo electrónico</td>
                <td class="px-4 py-2 text-green-600 font-semibold">✔ ACTIVADO</td>
              </tr>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Identificador de correo electrónico</td>
                <td class="px-4 py-2">{session.user!.email}</td>
              </tr>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Nombre</td>
                <td class="px-4 py-2">{session.user!.name}</td>
              </tr>
            </tbody>
          </table>

          <h2 class="text-xl font-bold mb-4">Estado de Membresía</h2>
          <table class="w-full table-auto text-sm mb-6">
            <tbody>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Estado</td>
                <td class="px-4 py-2 text-red-600 font-semibold">✘ EXPIRAR</td>
              </tr>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Paquete</td>
                <td class="px-4 py-2">30 DÍAS</td>
              </tr>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Fecha de Pago</td>
                <td class="px-4 py-2">15-04-2025 11:29</td>
              </tr>
              <tr class="border-t">
                <td class="px-4 py-2 font-medium">Fecha de Caducidad</td>
                <td class="px-4 py-2">15-05-2025 11:29</td>
              </tr>
            </tbody>
          </table>

          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex-1">
              <i class="fas fa-credit-card mr-2"></i> Comprar Membresía
            </button>
            <input type="text" placeholder="Ingrese código de cupón" class="border border-gray-300 rounded-lg px-4 py-2 flex-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>
      </div>

      <!-- Modal para cambiar contraseña -->
      <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="relative bg-white rounded-xl p-6 w-full max-w-md shadow-lg">
          <button onclick="document.getElementById('modal').classList.add('hidden')" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl font-bold" aria-label="Cerrar">
            &times;
          </button>
          <h2 class="text-xl font-bold text-orange-600 mb-4">CAMBIAR CONTRASEÑA</h2>
          <form>
            <label class="block font-semibold text-sm mb-1">
              Nueva contraseña <span class="text-orange-600">*</span>
            </label>
            <input type="password" placeholder="Nueva contraseña" class="w-full mb-4 px-4 py-2 border rounded-lg">
            <label class="block font-semibold text-sm mb-1">
              Confirmar nueva contraseña <span class="text-orange-600">*</span>
            </label>
            <input type="password" placeholder="Confirmar nueva contraseña" class="w-full mb-4 px-4 py-2 border rounded-lg">
            <div class="flex justify-end gap-2">
              <button type="button" onclick="guardarContrasena()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                Guardar
              </button>
              <button type="button" onclick="document.getElementById('modal').classList.add('hidden')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-xs text-center text-gray-500 mt-8">
        <p>Contamos con todos los canales a tu disposición</p>
        <p class="mt-1">
          Estamos disponibles por WhatsApp y te respondemos al instante.
          <a href="https://wa.me/51930327563" target="_blank" class="text-orange-500 hover:underline">WhatsApp</a>
        </p>
      </footer>
    </div>
  </body>
</MainLayout>
